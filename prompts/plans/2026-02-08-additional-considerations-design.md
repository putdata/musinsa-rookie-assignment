# 추가 고려사항 도출 및 구현 계획

## 개요

현재 핵심 기능(강좌 조회, 수강신청/취소, 동시성 제어)이 구현된 상태에서, 명시되지 않은 요구사항과 누락된 고려사항을 도출하고 우선순위를 정리한 문서.

총 50개 항목을 8개 섹션에서 식별하고, 4단계 우선순위로 분류함.

---

## 섹션 1: 예외 처리 & 입력 검증

현재 `GlobalExceptionHandler`가 `BusinessException`만 처리하여, 다른 예외 발생 시 API 명세와 다른 형식의 에러가 반환됨.

| # | 항목 | 현재 상태 | 결정 |
|---|------|----------|------|
| 1 | `@Valid` 검증 실패 | Spring 기본 에러 반환 | `INVALID_REQUEST` 에러코드로 통합 처리 |
| 2 | 잘못된 JSON 본문 | Spring 기본 에러 반환 | `INVALID_REQUEST`로 처리 |
| 3 | 잘못된 경로 파라미터 타입 | Spring 기본 에러 반환 | `INVALID_REQUEST`로 처리 |
| 4 | 존재하지 않는 엔드포인트 | Spring 기본 404 | 통합 에러 형식으로 래핑 |
| 5 | 예기치 못한 서버 오류 | 스택트레이스 노출 가능 | `INTERNAL_ERROR`로 처리, 스택트레이스 숨김 |
| 6 | 음수/0 ID 값 요청 | 검증 없음 | `@Positive` 어노테이션 추가 |

**근거:** 평가자가 "API 문서만으로 테스트를 작성할 수 있어야" 한다고 했으므로, 모든 에러 케이스에서 일관된 응답 형식이 필수.

---

## 섹션 2: 수강취소 동시성 & 권한 검증

| # | 항목 | 현재 상태 | 결정 |
|---|------|----------|------|
| 7 | 동일 수강신청 동시 취소 | Course 락으로 순차 처리됨 | 현재 구현으로 충분. 첫 번째 성공, 두 번째 404 반환 |
| 8 | 수강신청과 취소 동시 발생 | Course 비관적 락으로 순차 처리 | 현재 구현으로 충분 |
| 9 | 본인 확인 없는 취소 | enrollment ID만으로 누구나 취소 가능 | 인증 미구현이므로 의도적 허용. REQUIREMENTS.md에 명시 |
| 10 | 수강취소 후 재신청 | 제한 없음 | 제한 없이 허용. REQUIREMENTS.md에 명시 |
| 11 | 동일 학생 동시 다중 취소 | Student 락 없이 Course 락만 사용 | 취소는 학점/시간 검증 불필요하므로 Student 락 불필요. 현재 구현 적절 |

**핵심:** 9번 — 인증 미구현에 따른 제약사항을 문서에 명시하여, 의도적 결정임을 보여줌.

---

## 섹션 3: 데이터 생성 & 정합성

| # | 항목 | 현재 상태 | 결정 |
|---|------|----------|------|
| 12 | 강좌 정원 범위 | 코드에서 설정하지만 문서화 안 됨 | 정원 범위와 근거를 문서화 |
| 13 | 교수 1인당 최대 강의 수 | 학과당 50강좌 / 10교수 = 5개 | 현실적 범위로 문서화 |
| 14 | 교수 시간 충돌 방지 | 구현되어 있으나 문서화 안 됨 | "교수 시간표도 충돌 없이 생성" 명시 |
| 15 | 초기 수강신청 데이터 | 생성하지 않음 (빈 상태) | 의도적 결정으로 문서화. 평가자가 직접 테스트 가능 |
| 16 | 학생 학번 규칙 | 자동 생성되지만 형식 미문서화 | 학번 형식 문서화 |
| 17 | 학년 분포 | 균등 배분이지만 문서화 안 됨 | 1~4학년 균등 분배 명시 |
| 18 | 테스트 프로파일 분리 | DataInitializer가 테스트에서도 실행됨 | 현재 `@DirtiesContext`로 우회. 현재 전략 유지 |

---

## 섹션 4: API 설계 & 프론트엔드 연동

| # | 항목 | 현재 상태 | 결정 |
|---|------|----------|------|
| 19 | CORS 설정 | 미구현 | 개발 환경에서 전체 origin 허용, 문서화 |
| 20 | 페이징 | 미구현, 전체 반환 | 1차 전체 반환 유지. 확장 방안 문서화 |
| 21 | 정렬 기준 | 미문서화 | 학생/강좌/교수 모두 ID 오름차순. 명시 |
| 22 | Swagger/OpenAPI 어노테이션 | 미적용 | Controller에 어노테이션 추가 |
| 23 | 응답 래핑 구조 | 리스트 직접 반환 | 현재 유지. 페이징 추가 시 래핑 구조 확장 가능함을 문서화 |
| 24 | Content-Type 명시 | Spring 기본값 | `application/json` 기본 동작으로 충분 |

---

## 섹션 5: 로깅 & 모니터링 & 운영 품질

| # | 항목 | 현재 상태 | 결정 |
|---|------|----------|------|
| 25 | 수강신청 로깅 | 로깅 전무 | 수강신청 성공/실패 시 INFO/WARN 로그 추가 |
| 26 | 요청/응답 로깅 | 없음 | GlobalExceptionHandler에서 에러 로깅 추가 |
| 27 | 동시성 락 타임아웃 | 미설정 (무한 대기) | `@QueryHints`로 lock.timeout 설정 |
| 28 | 트랜잭션 타임아웃 | 미설정 | 명시적 타임아웃 설정 검토 (Tier 4) |
| 29 | DB 커넥션 풀 설정 | H2 기본값 | H2 인메모리 환경에서 영향 미미 (Tier 4) |
| 30 | Health Check 확장 | 단순 응답만 | 현재로 충분 (Tier 4) |

**핵심:** 27번(락 타임아웃) — 데드락 방지를 위해 락 순서를 고정했지만, 타임아웃은 최후의 안전장치.

---

## 섹션 6: 테스트 전략 & 커버리지 공백

| # | 항목 | 현재 상태 | 결정 |
|---|------|----------|------|
| 31 | 경계값 테스트 | 없음 | 정확히 18학점/정원 도달 경계값 테스트 추가 |
| 32 | 동시성 테스트 다양화 | 정원 초과 1건만 | 동일 학생 다중 강좌 동시 신청, 신청+취소 동시 발생 등 추가 |
| 33 | 조회 API 테스트 | 일부만 | 각 Controller별 테스트 추가 (Tier 4) |
| 34 | 입력 검증 테스트 | 없음 | null, 음수 ID 등 잘못된 입력 응답 검증 |
| 35 | 데이터 초기화 테스트 | 없음 | 서버 기동 후 데이터 수량 확인 (Tier 4) |
| 36 | 테스트 격리 전략 | `@DirtiesContext` | 현재 전략 유지 |

---

## 섹션 7: 제출물 완성 & 평가 대응

| # | 항목 | 현재 상태 | 결정 |
|---|------|----------|------|
| 37 | README.md | **미작성** | 빌드/실행 방법, 접속 정보, H2 콘솔, Swagger UI 경로 포함 |
| 38 | prompts/ 디렉토리 | **미작성** | AI 프롬프트 이력 제출 |
| 39 | Swagger 어노테이션 | 미적용 | Controller에 `@Tag`, `@Operation`, `@ApiResponse` 적용 |
| 40 | 평가자용 테스트 가이드 | 없음 | README.md에 빠른 테스트 흐름 안내 |
| 41 | Git 커밋 이력 | 현재 5개 | 앞으로 기능 단위 커밋 분리 |
| 42 | 명시되지 않은 평가 요소 | 미대응 | 코드 품질, 방어적 프로그래밍, 문서 완성도 강화 |

---

## 섹션 8: 의도적 미구현 사항

검토했으나 의도적으로 미구현한 항목. REQUIREMENTS.md에 근거와 함께 기록.

| # | 항목 | 미구현 근거 |
|---|------|-----------|
| 43 | 선수과목 제한 | 기획팀 요청 없음. 강좌 간 의존관계 도입 시 데이터 모델 복잡도 급증 |
| 44 | 학년별 수강 제한 | 기획팀 요청 없음. 학년 필드 존재하므로 향후 확장 가능 |
| 45 | 전공/교양 구분 | 기획팀 요청 없음. Course에 카테고리 필드 추가로 확장 가능 |
| 46 | 수강신청 기간 관리 | 기획팀이 기간 제한 미언급. 상시 신청/취소 가능으로 운영 |
| 47 | 최소 수강 학점 | 최대 18학점만 명시. 최소 학점 제한은 학사 정책이므로 미구현 |
| 48 | 성적/이수 관리 | 수강신청 시스템 범위 밖. 별도 시스템으로 분리 |
| 49 | 대기열(웨이팅) | 정원 초과 시 즉시 실패 반환. 대기열은 UX 복잡도 증가 |
| 50 | 수강 변경(교체) | 취소 후 재신청으로 대체. 이미 REQUIREMENTS.md에 기록됨 |

---

## 우선순위 분류

### Tier 1: 즉시 필요 (감점 방지)

없으면 평가에서 직접적 감점.

| # | 항목 | 이유 |
|---|------|------|
| 37 | **README.md 작성** | 필수 제출물. 빌드/실행 실패 시 이후 평가 불가 |
| 38 | **prompts/ 디렉토리** | "누락 시 감점" 명시 |
| 1-5 | **GlobalExceptionHandler 완성** | 잘못된 입력 테스트 시 일관성 없는 응답 → 품질 감점 |

### Tier 2: 높은 가점 (핵심 차별화)

평가 기준에 직접 언급된 항목.

| # | 항목 | 이유 |
|---|------|------|
| 32 | **동시성 테스트 다양화** | "동시 요청 시나리오로 직접 검증" 명시 |
| 31,34 | **경계값/입력검증 테스트** | 테스트 커버리지 평가 |
| 39 | **Swagger 어노테이션** | "API 문서를 잘 만들어주시면" 직접 대응 |
| 43-49 | **의도적 미구현 문서화** | "사고의 깊이" 평가 → REQUIREMENTS.md 보강 |
| 27 | **락 타임아웃 설정** | 동시성 제어 견고성 |

### Tier 3: 중간 가점 (품질 향상)

직접 언급은 없지만 코드 품질/운영 관점에서 가치 있음.

| # | 항목 | 이유 |
|---|------|------|
| 19 | **CORS 설정** | 프론트 연동 실용성 |
| 25-26 | **로깅 추가** | 운영 품질, "스스로 고민한" 추가 점수 |
| 6 | **@Positive 파라미터 검증** | 방어적 프로그래밍 |
| 12-17 | **데이터 생성 결정 문서화** | 설계 문서 완성도 |
| 40 | **평가자용 테스트 가이드** | 평가 편의성 |
| 9-10 | **취소 정책 문서화** | 설계 결정 완성도 |
| 21,23 | **정렬/응답구조 문서화** | API 명세 완성도 |

### Tier 4: 낮은 우선순위 (있으면 좋음)

현재 구현으로 충분하거나 영향 미미.

| # | 항목 | 이유 |
|---|------|------|
| 28-29 | 트랜잭션 타임아웃, 커넥션 풀 | H2 인메모리 환경에서 영향 미미 |
| 30 | Health Check 확장 | 현재 요구사항 충족 |
| 33,35 | 조회 API/데이터 초기화 테스트 | 있으면 좋지만 핵심 아님 |
| 36 | 테스트 격리 전략 변경 | 현재 동작에 문제 없음 |
| 20 | 페이징 | 이미 미구현 결정됨, 문서화만 보강 |

---

## 구현 순서

1. **Tier 1** → README.md, prompts/, GlobalExceptionHandler 완성
2. **Tier 2** → 테스트 강화, Swagger, REQUIREMENTS.md 보강, 락 타임아웃
3. **Tier 3** → CORS, 로깅, 파라미터 검증, 문서 보강
4. **Tier 4** → 필요 시 추가
