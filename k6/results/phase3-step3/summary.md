# Phase 3 Step 3 부하테스트 결과

**측정 일시:** 2026-02-21
**실행 방법:** java -jar (직접 JAR 실행)
**k6 시나리오:** queue-enrollment-rush.js (Burst + Sustained 패턴)
**테스트 대상:** phase3-step3 (Redis Queue 기반 수강신청)
**측정 횟수:** 각 조건 2~3회 측정 후 평균

---

## 1. VU 확장성 테스트 (톰캣 1000 스레드 고정)

| 지표 | 1000 VU | 2000 VU | 3000 VU |
|------|:---:|:---:|:---:|
| **에러율** | 0% | 0% | 0% |
| **수강 성공** | 3,957 | 3,957 | 3,957 |
| **Submit p95** | 1.5ms | 2.8ms | 9.8ms |
| **Submit p95 (Burst)** | 2.3ms | 6.0ms | 23.3ms |
| **Submit p95 (Sustained)** | 1.2ms | 1.5ms | 1.5ms |
| **Wait p95** | 2.5s | 5.5s | 8.5s |
| **iterations/s** | 353.7 | 352.0 | 352.3 |
| **req/s** | 992 | 1,461 | 1,838 |

### 분석

- **에러율 0%**: 3000 VU에서도 서버 에러 없이 전량 처리.
- **수강 성공 3,957건 일정**: 정원 제한이 정확히 동작. 동시성 제어 완벽.
- **Submit p95**: median이 0.5~0.6ms로 서브 밀리초 응답. 3000 VU Burst에서도 23.3ms로 안정적.
- **Wait p95**: VU에 비례 증가 (2.5s → 5.5s → 8.5s). Step 2와 동일.
- **iterations/s ~352로 수렴**: VU와 무관하게 일정. 큐 워커 처리 한계.

---

## 2. 톰캣 스레드풀 비교 (3000 VU 고정)

| 지표 | 500t | 1000t | 2000t |
|------|:---:|:---:|:---:|
| **에러율** | 0% | 0% | 0% |
| **수강 성공** | 3,957 | 3,957 | 3,957 |
| **Submit p95** | 7.8ms | 9.8ms | 7.5ms |
| **Submit p95 (Burst)** | 15.5ms | 23.3ms | 17.3ms |
| **Submit p95 (Sustained)** | 1.5ms | 1.5ms | 1.5ms |
| **Wait p95** | 8.5s | 8.5s | 8.5s |
| **iterations/s** | 353.2 | 352.3 | 352.8 |
| **req/s** | 1,842 | 1,838 | 1,835 |

### 분석

모든 지표가 스레드 수와 **무관하게 동일**하다. Submit p95도 7.5~9.8ms 범위로 오차 수준.

Step 2에서는 500t의 Submit(23.5ms)이 1000t(101.8ms)보다 4배 빨랐으나, Step 3에서는 그 차이마저 사라졌다. Submit 자체가 서브 밀리초로 경량화되면서 스레드 수에 따른 Redis 경합 문제도 해소되었다.

**결론:** 톰캣 스레드풀이 어떤 지표에도 영향을 주지 않으므로, 메모리 효율을 위해 **500t로도 충분**하다.

---

## 3. Step 2 vs Step 3 비교 (1000t 기준)

| 지표 | Step 2 (1000VU) | Step 3 (1000VU) | Step 2 (2000VU) | Step 3 (2000VU) | Step 2 (3000VU) | Step 3 (3000VU) |
|------|:---:|:---:|:---:|:---:|:---:|:---:|
| **Submit p95** | 4.8ms | **1.5ms** | 8.5ms | **2.8ms** | 101.8ms | **9.8ms** |
| **Submit p95 (Burst)** | 6.7ms | **2.3ms** | 23ms | **6.0ms** | 173.3ms | **23.3ms** |
| **Submit p95 (Sustained)** | 3.8ms | **1.2ms** | 5.3ms | **1.5ms** | 5.3ms | **1.5ms** |
| **Wait p95** | 2.5s | 2.5s | 5.5s | 5.5s | 8.5s | 8.5s |
| **iterations/s** | 349.8 | 353.7 | 349.1 | 352.0 | 348.9 | 352.3 |

### 핵심 개선

- **Submit p95**: 전 구간 **3~10배 개선**. 특히 3000 VU에서 101.8ms → 9.8ms.
- **Submit median**: Step 2의 2ms → Step 3의 0.5~0.6ms. **4배 빠름**.
- **Sustained Submit**: 3.8~5.3ms → 1.2~1.5ms로 서브 밀리초 수준.
- **Wait, iterations/s**: 동일. 큐 워커 처리량은 변화 없음.
- **스레드풀 민감도 해소**: Step 2는 500t가 Submit에서 유리했으나, Step 3는 차이 없음.

Step 3의 개선은 **큐 제출(Submit) 경량화**에 집중된 것이다.

---

## 4. 종합 결론

### 최적 구성

| 항목 | 권장 값 | 근거 |
|------|---------|------|
| 톰캣 스레드 | **500** | 모든 스레드 수에서 성능 동일, 메모리 효율 |
| 운영 가능 VU | **~2000** | Submit p95 2.8ms, Wait 5.5s |
| 시스템 처리 한계 | **~352 iter/s** | VU·스레드 수와 무관하게 수렴 |

### 핵심 발견

1. **Submit 서브 밀리초 달성**: median 0.5ms, p95 1.5ms (1000 VU 기준)
2. **톰캣 스레드풀 완전 무관**: 500t~2000t에서 모든 지표 동일
3. **큐 워커가 유일한 병목**: ~352 iter/s로 Step 2(~349)와 거의 동일
4. **에러율 0%, 정원 제어 완벽**: 모든 조건에서 유지
